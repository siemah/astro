---
import { SEO, Props as SeoProps } from "astro-seo";
import { GoogleAnalytics } from "@astrolib/analytics";
import { getStoreDetails } from "../../helpers/services/store/details";
import globalLinks from "../../config/links";
import { generateFavicon } from "../../helpers/images";
import "bootstrap/dist/css/bootstrap.min.css";
import "../../assets/css/helpers.css";
import "../../assets/css/media.css";
import "../../assets/css/owl.min.css";
import "../../assets/css/owl.default.min.css";

export interface Props extends SeoProps {
  image?: string;
  product_stock_url: string;
  store_shipping: string;
  store_checkout_url: string;
  storeAnalytics?: {
    "google-analytics"?: string | null;
    "facebook-pixel"?: string | null;
  } | null;
}
const pageUrl = Astro.url;
const {
  title = "",
  description = "",
  image = "",
  storeAnalytics,
  product_stock_url,
  store_shipping,
  store_checkout_url,
  ...seoProps
} = Astro.props;
const websiteDetails = await getStoreDetails(globalLinks.website);
const domain =
  websiteDetails?.store_build_settings?.store_domain || import.meta.env.DOMAIN;
let favicon = await generateFavicon(
  websiteDetails?.store_primary_settings?.store_ui?.store_logo,
  domain
);
---

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width" />
  <meta name="generator" content={"zzenz v1.0.0"} />
  <SEO
    title={title}
    titleTemplate={`%s - ${import.meta.env.DOMAIN}`}
    canonical={`${pageUrl}`}
    description={description}
    openGraph={{
      basic: {
        title: title,
        type: "website",
        url: `${pageUrl}`,
        image: image,
      },
      image: {
        alt: title,
      },
      optional: {
        description: description,
        siteName: domain,
      },
    }}
    twitter={{
      title: title,
      image: image,
      creator: "@zzenzapp",
      description: description,
      site: domain,
      card: "summary_large_image",
      imageAlt: title,
    }}
    extend={{
      ...(seoProps?.extend || {}),
      meta: [
        {
          name: "product_stock_url",
          content: product_stock_url,
        },
        {
          name: "store_shipping",
          content: store_shipping,
        },
        {
          name: "store_checkout_url",
          content: store_checkout_url,
        },
        ...(seoProps?.extend?.meta || []),
      ],
      link: [
        { rel: "icon", href: favicon, type: "image/png" },
        { rel: "preconnect", href: "https://images.weserv.nl" },
        { rel: "dns-prefetch", href: "https://images.weserv.nl" },
        { rel: "preconnect", href: "https://fonts.googleapis.com" },
        { rel: "dns-prefetch", href: "https://fonts.googleapis.com" },
        { rel: "preconnect", href: "https://images.zzenz.com" },
        { rel: "dns-prefetch", href: "https://images.zzenz.com" },
        {
          rel: "preload",
          href: "https://code.jquery.com/jquery-3.6.4.slim.min.js",
        },
        {
          rel: "preload",
          href: "https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js",
        },
        {
          rel: "sitemap",
          href: "/sitemap-index.xml",
        },
        ...(seoProps?.extend?.link || []),
      ],
    }}
  />
  {
    !!storeAnalytics?.["google-analytics"] && (
      <GoogleAnalytics
        id={storeAnalytics?.["google-analytics"]}
        partytown={true}
      />
    )
  }
  {
    !!storeAnalytics?.["facebook-pixel"] && (
    <script type="text/javascript" is:inline set:html={`
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script', 'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', ${storeAnalytics?.["facebook-pixel"]});
      fbq('track', 'PageView');
    `}
    />
    <meta name="facebook-pixel-id" content={storeAnalytics?.["facebook-pixel"]} />
    <noscript>
      <img height="1" width="1" style="display:none" src={`https://www.facebook.com/tr?id=${storeAnalytics['facebook-pixel']}&ev=PageView&noscript=1`}/>
    </noscript>
    )
  }
</head>
